name: Spring_test
env:
  APPLICATION_NAME: apptry
on: push
  
jobs:
  Spring_job:
    runs-on: ubuntu-latest       
  
    steps:      
      #- name: Update
      #  run: sudo apt update && sudo apt dist-upgrade
      
      - name: Copy repo 
        uses: actions/checkout@v2
        
      - name: Create docker network
        run: docker network create -d bridge --subnet=10.10.0.0/24 internal_net
              
      - name: set image for build
        run: docker build -t spring_boot .
        
      - name: run application container
        run: docker run --name ${{ env.APPLICATION_NAME }} -d -p 5050:8080 --net internal_net --ip 10.10.0.12 spring_boot 
                
      - name: check
        run: docker inspect ${{ env.APPLICATION_NAME }}
        
      - name: curl
        run: docker run --rm --network internal_net --ip 10.10.0.13 curlimages/curl:latest http://${{ env.APPLICATION_NAME }}:5050/?id=4
        
      - name: send requests
        run: curl -v --no-tcp-nodelay http://localhost:5050?id=3 --retry 3
        
      - name: send requests22
        run: curl -X POST -v -F 'id=4' -F 'name=Aleks' http://localhost:5050 --retry 3
